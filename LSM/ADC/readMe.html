<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<meta name="author" content="Peter Vranken">
<title>Sample "ADC" - A reusable analog input driver for MPC5643L</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:initial}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px 0}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:.4em .75em 0 .75em;line-height:1;vertical-align:top}
.colist>table tr>td:first-of-type img{max-width:initial}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Sample "ADC" - A reusable analog input driver for MPC5643L</h1>
<div class="details">
<span id="author" class="author">Peter Vranken</span><br>
<span id="email" class="email">mailto:Peter_Vranken@Yahoo.de</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_about_this_sample">1. About this sample</a></li>
<li><a href="#_the_adc_driver">2. The ADC driver</a>
<ul class="sectlevel2">
<li><a href="#_pin_routing_using_siul">2.1. Pin routing using SIUL</a></li>
<li><a href="#_selection_of_channels">2.2. Selection of channels</a></li>
<li><a href="#_the_conversion_cycle_time">2.3. The conversion cycle time</a></li>
<li><a href="#_limitations">2.4. Limitations</a></li>
<li><a href="#_static_check_of_configuration">2.5. Static check of configuration</a></li>
</ul>
</li>
<li><a href="#_the_test_and_calibration_data_of_the_mcu">3. The test and calibration data of the MCU</a></li>
<li><a href="#_tools">4. Tools</a>
<ul class="sectlevel2">
<li><a href="#_environment">4.1. Environment</a></li>
<li><a href="#_compiler_and_makefile">4.2. Compiler and makefile</a></li>
<li><a href="#_flashing_and_debugging">4.3. Flashing and debugging</a></li>
</ul>
</li>
<li><a href="#_code_architecture">5. Code architecture</a>
<ul class="sectlevel2">
<li><a href="#_book_e_versus_vle">5.1. Book E versus VLE</a></li>
<li><a href="#_api">5.2. API</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_about_this_sample">1. About this sample</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This sample implements a reusable analog input driver for the NXP
MPC5643L. The sample started as a copy of sample "RTOS".</p>
</div>
<div class="paragraph">
<p>The startup code in folder <code>code\startup</code> is the same as for the other
samples, the sample makes use of the infrastructure it offers.</p>
</div>
<div class="paragraph">
<p>To see how the sample works you need to open a terminal software on your
host machine. You can find a terminal as part of the CodeWarrior Eclipse
IDE; go to the menu, "Window/Show View/Other/Terminal/Terminal".</p>
</div>
<div class="paragraph">
<p>Open the serial port, which is offered by the TRK-USB-MPC5643L. (On
Windows, open the Computer Management and go to the Device Manager to find
out.) The Baud rate has been selected as 115200 Bd in file
<code>code\mai_main.c</code>, 8 Bit, no parity, 1 start and stop Bit. The terminal
should print the messages, which are regularly sent by the sample code
running on the evaluation board.</p>
</div>
<div class="paragraph">
<p>In the sample, the three temperature sensors on the TRK-USB-MPC5643L are
measured with the ADC. The temperatures control the two LEDs. Normally,
they are red but if the temperature suddenly drops they change temporarily
to green. The color can be changed e.g. by blowing at the chips mounted on
the PCB.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_adc_driver">2. The ADC driver</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An essential requirement for an ADC driver is the hardware triggered
sampling time of the inputs. Naive, software controlled regular sampling
of an analog input can ensure the correct mean value of the timing but the
particular sampling times undergo a jitter. Such a jitter means a sampling
error, which increases in first order with the frequency of the input
information. So the sampling times need to be chosen without SW interaction.</p>
</div>
<div class="paragraph">
<p>For the MPC5643L, the ADC can be triggered from different I/O devices. The
trigger clock is routed from the selected device through the CTU to the ADC.
This ADC driver uses the Enhanced Motor Control Timer as trigger source.
All in all it configures four devices:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It uses one channel of one of the two Enhanced Motor Control Timer
modules eTimer_0 or eTimer_1 (module eTimer_2 is not connected to the
CTU)</p>
</li>
<li>
<p>The CTU is configured to command the ADCs to do the sampling. It has the
eTimer module as input</p>
</li>
<li>
<p>The two ADCs are identical configured such that they wait for the CTU
commands and do the conversions. (Only a single ADC is configured if all
enabled channels should belong to the same ADC)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The ADC conversion results are written into a global array of values,
which serves as API of the module. The array is updated after each
conversion cycle. The application code can be notified by callback about
the availability of a new result. This supports synchronous processing of
the sampled analog input signal.</p>
</div>
<div class="paragraph">
<p>Fetching the channel conversion results from the ADC devices after
completion of a conversion cycle is done by interrupt and CPU interaction.
No support of the DMA mode is implemented. This design fits well to the
aimed sampling rates in the magnitude of a Kilohertz.</p>
</div>
<div class="sect2">
<h3 id="_pin_routing_using_siul">2.1. Pin routing using SIUL</h3>
<div class="paragraph">
<p>The external inputs to the ADCs are not configured by this driver. The
programming of the SIUL to route the MCU pins to the ADC inputs needs to
be done by the client code prior to starting the conversions.</p>
</div>
</div>
<div class="sect2">
<h3 id="_selection_of_channels">2.2. Selection of channels</h3>
<div class="paragraph">
<p>The configuration of the driver is done at compile time and using
preprocessor #define&#8217;s. See files
<a href="https://github.com/PeterVranken/TRK-USB-MPC5643L/blob/master/LSM/ADC/code/ADC/adc_eTimerClockedAdc.h"><code>adc_eTimerClockedAdc.h</code></a>
and
<a href="https://github.com/PeterVranken/TRK-USB-MPC5643L/blob/master/LSM/ADC/code/ADC/adc_eTimerClockedAdc.c"><code>adc_eTimerClockedAdc.c</code></a>
for details.</p>
</div>
<div class="paragraph">
<p>The principal setting is the definition of the set of channels, which is
converted in every cycle. The header file <code>adc_eTimerClockedAdc.h</code>
contains a #define for each physically available channel (e.g.
<code>ADC_USE_ADC_0_CHANNEL_01</code>), which has to be set to either one or zero. It
is not possible to define or change the set of enabled channels at
run-time. Moreover, it is not possible to sample different channels at
different rates. The conversion cycle is defined (set of channels, cycle
time and settings for a single conversion) and this cycle is repeated all
time long. The configuration is done with preprocessor macros, mainly
found in the header file <code>adc_eTimerClockedAdc.h</code>.</p>
</div>
<div class="paragraph">
<p>The internal signals TSENS_0,  TSENS_1 and VREG_1.2V can be configured
for conversion as any other channel, however this has specific side
effects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If and only if the temperature signals TSENS_0 and TSENS_1, channels 15,
ADC_0 and ADC_1, respectively, are element of the set of converted
channels then there are APIs to read the temperature signals in degree
Celsius</p>
</li>
<li>
<p>If the reference voltage VREG_1.2V, channels 10, ADC_0 and ADC_1,
respectively, are element of the set of converted channels then the
averaged measured reference voltage is used to calibrate all other
channels of the given ADC unit in Volt</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_the_conversion_cycle_time">2.3. The conversion cycle time</h3>
<div class="paragraph">
<p>The next important setting is the duration of the conversion cycle, see
macro <code>ADC_T_CYCLE_IN_US</code>. The settings for the timing of a single
conversion are hard-coded in the driver but the period at which the
conversion of all enabled channels is repeated is user configured. As an
example, our sample sets this value to 1000 in order to achieve a sampling
frequency of 1 kHz. Sampling and conversion of the few enabled channels
roughly takes 10 us per cycle; it&#8217;s quite normal for an ADC application
that the cycle time has a long idle phase.</p>
</div>
<div class="paragraph">
<p>Some more settings are documented in both, the header and the
implementation file of the ADC driver. Please refer directly to these
files.</p>
</div>
</div>
<div class="sect2">
<h3 id="_limitations">2.4. Limitations</h3>
<div class="paragraph">
<p>Some configuration items of the driver are hard-coded and not modelled as
compile-time #define&#8217;s. Depending on the application, these settings and
thus the implementation of the driver may become subject to your
modifications. A prominent example is the conversion timing. The related
settings are chosen for a rather slow sampling rate but better accuracy; a
rate of a few Kilohertz is targeted. Higher rates may require another
timing configuration and much higher rates could even require structural
code changes, like DMA support.</p>
</div>
</div>
<div class="sect2">
<h3 id="_static_check_of_configuration">2.5. Static check of configuration</h3>
<div class="paragraph">
<p>The configuration settings depend on one another. There are several
constraints like: A very short cycle time is impossible if the number of
active channels is large. Because we use preprocessor macros for
configuration, most of the constraints can be checked at compile time
using preprocessor conditions and the _Static_assert keyword. Therefore,
there are barely run-time errors recognized and reported by the code. A
bad configuration will simply not compile.</p>
</div>
<div class="sect3">
<h4 id="_adc_as_operating_system_clock">2.5.1. ADC as operating system clock</h4>
<div class="paragraph">
<p>To avoid sampling errors at higher signal frequencies it is generally a
must to have a hardware timer to regularly trigger all conversions. If the
same clock can be used for the scheduler of the application tasks then a
software design becomes possible, where the ADC results are synchronously
acquired by hardware and processed by software and this without fearing
any race conditions. This is, what the sample demonstrates by connecting
the ADC conversions with the RTOS scheduler.</p>
</div>
<div class="paragraph">
<p>The ADC driver offers a notification callback on conversion cycle
complete. The sample installs the RTOS' system timer interrupt as this
callback and the ADC trigger source becomes the RTOS system clock at the
same time. The frequency is identical and the phase shift well-defined and
optimal; the first thing an RTOS controlled task can do is fetching and
evaluating the ADC results without fearing any race conditions.</p>
</div>
<div class="paragraph">
<p>Note, the sample uses an ADC cycle of 1 ms, yielding the standard system
clock of 1 kHz for the RTOS. The change of the cycle time is as easy as
changing a configuration macro in the ADC driver. There&#8217;s no technical
issue in doing so, but the RTOS documentation will become wrong wherever
it mentions the unit of time designations.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_test_and_calibration_data_of_the_mcu">3. The test and calibration data of the MCU</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Some elements of the ADC functionality depend on the test and calibration
data of the MCU. This data is specific to an individual device and is
programmed into it as part of the production process. The operation of the
ADC requires reading this data from a hidden area of the flash ROM.</p>
</div>
<div class="paragraph">
<p>Reading the test and calibration data is complex insofar as it cannot be
done on the fly by some dependent code&#8201;&#8212;&#8201;like our ADC driver&#8201;&#8212;&#8201;, which
needs to know it. The hardware permits exactly one read access per
power-up cycle. Consequently, an application that depends on the test and
calibration data, needs to have a global instance, which reads the data
once at system startup time and which provides the information later on
demand to whom it may concern.</p>
</div>
<div class="paragraph">
<p>Module <code>mcuTestAndCalData</code>, which is provided by this sample, implements
this concept. It is kept independent from the ADC driver. The
self-contained module can be easily reused in other contexts, where access
to the test and calibration data is an issue.</p>
</div>
<div class="paragraph">
<p>Technical constraints make it impossible to access the test and
calibration data from C code. The core function is written in assembler
but it has a C API for convenient usage.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tools">4. Tools</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_environment">4.1. Environment</h3>
<div class="sect3">
<h4 id="_command_line_based_build">4.1.1. Command line based build</h4>
<div class="paragraph">
<p>The makefiles and related scripts require a few settings of the
environment in the host machine. In particular, the location of the GNU
compiler installation needs to be known and the PATH variable needs to
contain the paths to the required tools.</p>
</div>
<div class="paragraph">
<p>For Windows users there is a shortcut to PowerShell in the root of this
project (not sample), which opens the shell with the prepared environment.
Furthermore, it creates an alias to the appropriate GNU make executable.
You can simply type <code>make</code> from any location to run MinGW32 GNU make.</p>
</div>
<div class="paragraph">
<p>The PowerShell process reads the script <code>setEnv.ps1</code>, located in the
project root, too, to configure the environment. This script requires
configuration prior to its first use. Windows users open it in a text
editor and follow the given instructions that are marked by TODO tags.
Mainly, it&#8217;s about specifying the installation directory of GCC.</p>
</div>
<div class="paragraph">
<p>Non-Windows users will read this script to see, which (few) environmental
settings are needed to successfully run the build and prepare an according
script for their native shell.</p>
</div>
</div>
<div class="sect3">
<h4 id="_eclipse_for_building_flashing_and_debugging">4.1.2. Eclipse for building, flashing and debugging</h4>
<div class="paragraph">
<p>Flashing and debugging is always done using the NXP CodeWarrior Eclipse
IDE, which is available for free download. If you are going to run the
application build from Eclipse, too, then the same environmental settings
as decribed above for a shell based build need to be done for Eclipse. The
easiest way to do so is starting Eclipse from a shell, that has executed
the script <code>setEnv.ps1</code> prior to opening Eclipse.</p>
</div>
<div class="paragraph">
<p>For Windows users the script <code>CW-IDE.ps1</code> has been prepared. This script
requires configuration prior to its first use. Windows users open it in a
text editor and follow the given instructions that are marked by TODO
tags. Mainly, it&#8217;s about specifying the installation directory of
CodeWarrior.</p>
</div>
<div class="paragraph">
<p>Non-Windows users will read this script to see, which (few) environmental
and path settings are needed to successfully run the build under control
of Eclipse and prepare an according script for their native shell.</p>
</div>
<div class="paragraph">
<p>Once everything is prepared, the CodeWarrior Eclipse IDE will never be
started other than by clicking the script <code>CW-IDE.ps1</code> or its equivalent
on non-Windows hosts.</p>
</div>
<div class="paragraph">
<p>See <a href="https://github.com/PeterVranken/TRK-USB-MPC5643L">project overview</a> and
<a href="https://github.com/PeterVranken/TRK-USB-MPC5643L/wiki/Tools-and-Installation">GitHub
Wiki</a> for more details about downloading and installing the required
tools.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compiler_and_makefile">4.2. Compiler and makefile</h3>
<div class="paragraph">
<p>Compilation and linkage are makefile controlled. The compiler is GCC
(MinGW-powerpc-eabivle-4.9.4). The makefile is made generic and can be
reused for other projects, not only for a tiny "Hello World" with a few
source files. It supports a number of options (targets); get an overview
by typing:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cd &lt;projectRoot&gt;/LSM/ADC
mingw32-make help</pre>
</div>
</div>
<div class="paragraph">
<p>The main makefile <code>GNUmakefile</code> has been configured for the build of
sample "ADC". Type:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>mingw32-make -s build
mingw32-make -s build CONFIG=PRODUCTION</pre>
</div>
</div>
<div class="paragraph">
<p>to produce the flashable files <code>bin\ppc\DEBUG\TRK-USB-MPC5643L-ADC.elf</code>
and <code>bin\ppc\PRODUCTION\TRK-USB-MPC5643L-ADC.elf</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The makefile requires the MinGW port of the make processor. The Cygwin
port will fail with obscure, misleading error messages. It&#8217;s safe to use
the <code>make.exe</code> from the compiler installation archive. The makefile is
designed to run on different host systems but has been tested with Windows
7 only.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_flashing_and_debugging">4.3. Flashing and debugging</h3>
<div class="paragraph">
<p>The sample code can be flashed and debugged with the CodeWarrior IDE.</p>
</div>
<div class="paragraph">
<p>To flash the <code>*.elf</code> file, open the CodeWarrior IDE, go to the menu, click
"Window/Show View/Other/Debug/Debugger Shell". In the debugger shell
window, type:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cd &lt;rootFolderOfSample&gt;/makefile/debugger
source flashDEBUG.tcl</pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="literalblock">
<div class="content">
<pre>source flashPRODUCTION.tcl</pre>
</div>
</div>
<div class="paragraph">
<p>The debugger is started by a click on the black triangle next to the blue
icon "bug", then click "Debug Configurations&#8230;&#8203;/CodeWarrior/Debug ADC
(DEBUG)". Confirm and start the debugger with a last click on button
"Debug".</p>
</div>
<div class="paragraph">
<p>You can find more details on using the CodeWarrior IDE at
<a href="https://github.com/PeterVranken/TRK-USB-MPC5643L/wiki/Tools-and-Installation" class="bare">https://github.com/PeterVranken/TRK-USB-MPC5643L/wiki/Tools-and-Installation</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_code_architecture">5. Code architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This sample builds on the basic sample "startup" located in a sibling
folder and it integrates the other packages "printf" and "RTOS". "ADC" is
compiled for the Book E instruction set. All build settings and the
software architecture are identical to "startup". Please refer to
<a href="https://github.com/PeterVranken/TRK-USB-MPC5643L/blob/master/LSM/startup/readMe.adoc">LSM/startup/readMe.adoc</a>
for details.</p>
</div>
<div class="sect2">
<h3 id="_book_e_versus_vle">5.1. Book E versus VLE</h3>
<div class="paragraph">
<p>The implementation of the actual sample does not depend on the chosen
instruction set. However, the startup code and the project settings have
been branched from another Book E sample. To use this sample with VLE, you
would
<a href="https://github.com/PeterVranken/TRK-USB-MPC5643L/wiki/How-to-clone-a-Sample">clone
a VLE sample</a> but take <code>mai_main.c</code> and the source code folders <code>ADC</code>,
<code>mcuTestAndCalData</code> <code>RTOS</code> and <code>serial</code> from this sample <code>ADC</code>&#8201;&#8212;&#8201;they
will properly compile in the VLE environment, too.</p>
</div>
</div>
<div class="sect2">
<h3 id="_api">5.2. API</h3>
<div class="paragraph">
<p>The ADC driver offers an API for using it.
  <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnote_1" title="View footnote.">1</a>]</sup>
  This section outlines, which functions are available and how to use
them. Detailed information is found as
<a href="https://github.com/PeterVranken/TRK-USB-MPC5643L/blob/master/LSM/ADC/code/ADC/adc_eTimerClockedAdc.c">source
code</a> comments.</p>
</div>
<div class="sect3">
<h4 id="_read_the_mcu_s_test_and_calibration_data">5.2.1. Read the MCU&#8217;s test and calibration data</h4>
<div class="paragraph">
<p>If the internal chip temperature sensors are configured for use then the
driver depends on the availability of the test and calibration data and
the initialization of module <code>mcuTestAndCalData</code> needs to be done prior to
the initialization of the ADC driver:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>#include "tac_mcuTestAndCalibrationData.h"
void tac_initTestAndCalibrationDataAry(void)</pre>
</div>
</div>
<div class="paragraph">
<p>After this call, the global array</p>
</div>
<div class="literalblock">
<div class="content">
<pre>const uint16_t tac_mcuTestAndCalibrationDataAry[]</pre>
</div>
</div>
<div class="paragraph">
<p>provides direct access to the test and calibration data to any code
instance, which depends on it. The contents of the table are described in
the MCU reference manual, section 23.1.8, p. 591, table 23-24. Note, table
23-24 is formatted in 32 Bit entries, whereas our array uses 16 Bit words.</p>
</div>
</div>
<div class="sect3">
<h4 id="_adc_driver_initialization">5.2.2. ADC driver initialization</h4>
<div class="paragraph">
<p>Before use of any other API function and before conversions can start the
initialization routine needs to be called. The invocation is done at
system startup time, normally before External Interrupt processing is
enabled, but this is not a must.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>#include "adc_eTimerClockedAdc.h"
void adc_initDriver( unsigned int priorityOfIRQ
                   , void (*cbEndOfConversion)(void)
                   )</pre>
</div>
</div>
<div class="paragraph">
<p>Data fetching is done by interrupt after the end of a conversion cycle.
The priority of the ISR can be controlled through <code>priorityOfIRQ</code>. The ISR
itself is internal to the driver.</p>
</div>
<div class="paragraph">
<p>The callback into the client code is optional. If enabled, it is invoked
from the same data-fetch ISR after retrieval of all conversion results. It
can be applied to evaluate or propagate the new results.</p>
</div>
<div class="paragraph">
<p>Note, if channel 15 of at least one ADC is enabled, i.e. if the internal
chip temperature is measured, then <code>tac_initTestAndCalibrationDataAry()</code>
needs to be called prior to <code>adc_initDriver()</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_getting_conversion_results">5.2.3. Getting conversion results</h4>
<div class="paragraph">
<p>After each conversion cycle, the results are stored in an API buffer. From
here and using the notification callback, they can be processed
synchronously with the conversion cycles. If not using the callback, they
can be fetched at any time from the buffer. In this case coherency of
reading several results becomes an issue.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>#include "adc_eTimerClockedAdc.h"
uint16_t adc_getChannelRawValue(adc_idxEnabledChannel_t idxChn)</pre>
</div>
</div>
<div class="paragraph">
<p>Get the raw conversion result of a single channel, i.e. the counter value
read for the ADC. The voltage range [0V .. supplied reference voltage] is
represented by counts from 0 till 2<sup>16</sup>.</p>
</div>
<div class="paragraph">
<p>The channel index relates to the set of enabled channels and the
enumeration <code>adc_idxEnabledChannel_t</code> is provided, which shapes the
association between index and physical channel</p>
</div>
<div class="literalblock">
<div class="content">
<pre>#include "adc_eTimerClockedAdc.h"
float adc_getChannelVoltage(adc_idxEnabledChannel_t idxChn)</pre>
</div>
</div>
<div class="paragraph">
<p>The conversion result of a channel can be fetched as voltage, too. The
re-scaling from count to Volt is either done assuming the nominal,
configured reference voltage or based on the comparison of a continuously
acquired measurement result of an internal band-gap reference voltage
source with the known voltage of that source. Which technique is applied
is decided by configuration at compile time.</p>
</div>
<div class="paragraph">
<p>The measured voltage can be fetched from the API buffer together with the
age (see below):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>#include "adc_eTimerClockedAdc.h"
float adc_getChannelVoltageAndAge( unsigned short *pAge
                                 , adc_idxEnabledChannel_t idxChn
                                 )</pre>
</div>
</div>
<div class="paragraph">
<p>This call ensures that channel result and age information origin from the
same conversion cycle.</p>
</div>
</div>
<div class="sect3">
<h4 id="_diagnosis_age_of_conversion_results">5.2.4. Diagnosis: Age of conversion results</h4>
<div class="paragraph">
<p>The ADC can report different run-time problems. These are not made
available at the API, since they will likely never occur once a
configuration is proven to work. However, they are respected by the driver
and the conversion results in the API buffer are not renewed if the
conversion cycle or a channel result reports a problem. This situation is
reported to the client code as age of the available results. The unit of
the age is the duration of a single conversion cycle, 1 ms in our sample.
As long as no problem is recognized the value will always be reported as
zero.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>#include "adc_eTimerClockedAdc.h"
unsigned short adc_getChannelAge(void)</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_coherent_reading_of_several_channel_results">5.2.5. Coherent reading of several channel results</h4>
<div class="paragraph">
<p>The API buffer is updated for all channels at once at the end of a
conversion cycle. It&#8217;ll generally be the case that the chosen priority of the
ADC ISR will be higher than that of the application tasks, insofar is the
update of all channel buffers an atomic operation to the application code.</p>
</div>
<div class="paragraph">
<p>Reading of channel results from the API buffer is however done channel by
channel and the buffer update can happen after the application read only a
subset of all channels.</p>
</div>
<div class="paragraph">
<p>Several possibilities exist if the application depends on getting all
channel results from one and the same conversion cycle:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The notification callback can be used to fetch (and process) the data
synchronously with its acquisition. Coherent reading of all channels is
granted if only the execution time of the callback is shorter than the
difference between conversion cycle time and conversion time. Our sample
demonstrates this possibility by clocking the RTOS from the notification
callback</p>
</li>
<li>
<p>The application reads all channels in a critical section. The methods
from the startup code can be used, see
<a href="https://github.com/PeterVranken/TRK-USB-MPC5643L/tree/master/LSM/startup#api" class="bare">https://github.com/PeterVranken/TRK-USB-MPC5643L/tree/master/LSM/startup#api</a></p>
</li>
<li>
<p>If our RTOS is used then its priority ceiling protocol API can be
applied to mutually exclude the application code and the ADC ISR</p>
</li>
<li>
<p>If the concern only is reading the value of a single channel coherently
with its age information then the dedicated method
<code>adc_getChannelVoltageAndAge</code> can be used</p>
</li>
<li>
<p>The reading of a single channel value has no issues. Both, raw value and
voltage, are implemented with basic data types, having atomic load and
store instructions. The functions <code>adc_getChannelRawValue()</code> and
<code>adc_getChannelVoltage()</code> can be called from any context at any time and
will return the last recently acquired conversion result</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_internal_chip_temperature">5.2.6. Internal chip temperature</h4>
<div class="paragraph">
<p>Simply by enabling channel 15 for one or both ADC units, the API for
computation and retrieval of the internal chip temperatures is generated in
the compiled code. (Otherwise this code is excluded from compilation.) The
temperature values are acquired like all analog channels in the each
conversion cycle and can be fetched at any time and from any context using
these API functions:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>#incude "adc_eTimerClockedAdc.h"
float adc_getTsens0(void);
float adc_getTsens1(void);</pre>
</div>
</div>
<div class="paragraph">
<p>The values are calibrated in degrees Celsius.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnote_1">
<a href="#_footnoteref_1">1</a>. If coherent reading of more than one channel result from one conversion cycle is a requirement then the <a href="https://github.com/PeterVranken/TRK-USB-MPC5643L/blob/master/LSM/startup/readMe.adoc">API offered by the startup code</a> is required, too, for implementing critical sections.
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-01-29 21:52:57 W. Europe Standard Time
</div>
</div>
</body>
</html>